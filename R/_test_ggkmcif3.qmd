---
title: "ggkmcif2"
format: docx
editor: source
---

```{r setup}
library(reportRmd)
data("pembrolizumab")
```

## Testing header above


```{r}
data(pembrolizumab)
tab <- rm_covsum(data = pembrolizumab,
                 covs = c("age", "sex"),
                 maincov = "cohort",
                 tableOnly = TRUE)

  # row.names = NULL;
  # to_indent = numeric(0);
  # bold_headers = TRUE;
  # rows_bold = numeric(0);
  # bold_cells = NULL;
  # caption = NULL;
  # digits = 2
  # applyAttributes = TRUE;
  # keep.rownames = FALSE;
  # nicenames = TRUE;
  # format = NULL;
  # header_above = c(" " = 2, "Cohort" = 5, " " = 1)

outTable(tab,
         header_above = c(" " = 2, "Cohort" = 5, " " = 1),format = "doc")
```

```{r}
outTable(tab,
         header_above = c(" " = 2, "Cohort" = 5, " " = 1),format = "doc",to_indent = 1:4,rows_bold = 1,applyAttributes = F)
```

## Testing include_unadjusted = T


```{r}
data("pembrolizumab")
glm_fit = glm(change_ctdna_group~sex*age+baseline_ctdna,
data=pembrolizumab,family = 'binomial')
rm_mvsum(glm_fit, include_unadjusted = T,tableOnly = T)
summary(glm_fit)$coefficients
```


# Checking small p values

```{r}
set.seed(123)
n <- 200
x1 <- rnorm(n)
x2 <- factor(sample(c("A","B","C"), n, replace = TRUE))
x3 <- rnorm(n)
y <- 2 + 3*x1 + ifelse(x2=="B", 4, ifelse(x2=="C", -3, 0)) + rnorm(n, sd = 0.5)
testdata <- data.frame(y = y, x1 = x1, x2 = x2, x3 = x3)
rm_mvsum(lm(y ~ x1 + x2 + x3, data = testdata), include_unadjusted = TRUE)

```

```{r}
library(reportRmd)
data("pembrolizumab")

# Model with NA coefficients (sex:cohort has empty cells causing aliasing)
glm_fit <- glm(change_ctdna_group ~ sex:cohort + baseline_ctdna,
               data = pembrolizumab, family = "binomial")

# Check which coefficients are NA
coef(glm_fit)

# Should now produce a table with a warning instead of an error
rm_mvsum(glm_fit, tableOnly = F)

```

```{r}
set.seed(42)
df <- data.frame(
  y  = rnorm(50),
  x1 = rnorm(50),
  x2 = factor(sample(c("A", "B"), 50, replace = TRUE))
)
df$x3 <- df$x1  # x3 is identical to x1 -> NA coefficient

fit <- lm(y ~ x1 + x2 + x3, data = df)
coef(fit)
rm_mvsum(fit, tableOnly = F)

```

